$ opam depext -iy -j 2 brotli.2.0.3
# Detecting depexts using vars: arch=x86_64, os=linux, os-distribution=ubuntu, os-family=debian
# The following system packages are needed:
libbrotli-dev
m4
The following command needs to be run through "sudo":
    apt-get install -qq -yy libbrotli-dev m4
debconf: delaying package configuration, since apt-utils is not installed
Selecting previously unselected package libbrotli1:amd64.
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 15325 files and directories currently installed.)
Preparing to unpack .../libbrotli1_1.0.3-1ubuntu1_amd64.deb ...
Unpacking libbrotli1:amd64 (1.0.3-1ubuntu1) ...
Selecting previously unselected package libbrotli-dev.
Preparing to unpack .../libbrotli-dev_1.0.3-1ubuntu1_amd64.deb ...
Unpacking libbrotli-dev (1.0.3-1ubuntu1) ...
Setting up libbrotli1:amd64 (1.0.3-1ubuntu1) ...
Setting up libbrotli-dev (1.0.3-1ubuntu1) ...
Processing triggers for libc-bin (2.27-3ubuntu1) ...
# OS packages installation successful
# Now letting OPAM install the packages
The following actions will be performed:
  - install ocamlgraph       1.8.8    [required by opam-core]
  - install result           1.3      [required by odoc]
  - install conf-brotli      0.0.1    [required by brotli]
  - install re               1.7.3    [required by tyxml, opam-core]
  - install base-bytes       base     [required by cppo, astring, tyxml]
  - install ocamlbuild       0.12.0   [required by bos]
  - install opam-file-format 2.0.0    [required by opam-format]
  - install octavius         1.2.0    [required by doc-ock]
  - install cppo             1.6.4    [required by doc-ock]
  - install uchar            0.0.2    [required by fmt, tyxml]
  - install topkg            0.9.1    [required by bos]
  - install menhir           20180703 [required by doc-ock-xml]
  - install opam-core        2.0.0    [required by opam-format]
  - install doc-ock          1.2.1    [required by odoc]
  - install xmlm             1.3.0    [required by odoc]
  - install rresult          0.5.0    [required by bos]
  - install cmdliner         1.0.2    [required by odoc, opam-installer]
  - install astring          0.8.3    [required by bos]
  - install opam-format      2.0.0    [required by opam-installer]
  - install doc-ock-xml      1.2.1    [required by odoc]
  - install uutf             1.0.1    [required by tyxml]
  - install fmt              0.8.5    [required by bos]
  - install fpath            0.7.2    [required by odoc]
  - install opam-installer   2.0.0    [required by brotli]
  - install tyxml            4.2.0    [required by odoc]                 For tyxml's ppx, please install tyxml-ppx.
  - install logs             0.6.2    [required by bos]
  - install doc-ock-html     1.2.1    [required by odoc]
  - install bos              0.2.0    [required by odoc]
  - install odoc             1.2.0    [required by brotli]
  - install brotli           2.0.3
===== 30 to install =====

<><> Gathering sources ><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
[astring.0.8.3] found in cache
[bos.0.2.0] found in cache
[brotli.2.0.3] found in cache
[cmdliner.1.0.2] found in cache
[cppo.1.6.4] found in cache
[doc-ock.1.2.1] found in cache
[doc-ock-html.1.2.1] found in cache
[doc-ock-xml.1.2.1] found in cache
[fmt.0.8.5] found in cache
[fpath.0.7.2] found in cache
[logs.0.6.2] found in cache
[menhir.20180703] found in cache
[ocamlbuild.0.12.0] found in cache
[ocamlgraph.1.8.8] found in cache
[octavius.1.2.0] found in cache
[odoc.1.2.0] found in cache
[opam-core.2.0.0] found in cache
[opam-file-format.2.0.0] found in cache
[opam-format.2.0.0] found in cache
[opam-installer.2.0.0] found in cache
[re.1.7.3] found in cache
[result.1.3] found in cache
[rresult.0.5.0] found in cache
[topkg.0.9.1] found in cache
[tyxml.4.2.0] found in cache
[uchar.0.0.2] found in cache
[uutf.1.0.1] found in cache
[xmlm.1.3.0] found in cache

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed base-bytes.base

#=== ERROR while installing conf-brotli.0.0.1 =================================#
"pkg-config": command not found.


<><> Error report <><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
+- The following actions failed
| - build   cppo        1.6.4
| - install conf-brotli 0.0.1
+- 
+- The following changes have been performed (the rest was aborted)
| - install base-bytes base
+- 
# Run eval $(opam env) to update the current shell environment

The former state can be restored with:
    opam switch import "/home/opam/.opam/4.06/.opam-switch/backup/state-20180819030101.export"
31 1534647654 1534647676